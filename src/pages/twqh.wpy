<template>
<view class="container">
    <view class="tou"></view>
    <view wx:for="{{twqh}}" wx:key="key" wx:for-item='item' wx:for-index="index">
        <view class="tuweiqinghua" @tap="tuweiqinghua({{item}})">
            💎 {{item.title}}
        </view>
    </view>
    <view class="textend" wx:if="{{!isend}}">加载中......</view>
    <view class="textend" wx:if="{{isend}}">恋爱联盟良心出品</view>
</view>
</template>
<script>
import wepy from 'wepy';
import tip from '@/utils/tip';
import api from '@/api/api';
import {
  SYSTEM_INFO,
  USER_SPECICAL_INFO
} from '@/utils/constant';

export default class dingdan extends wepy.page {
    config = {
        navigationBarTitleText: '土味情话',
        enablePullDownRefresh:true,
        enableReachBottom:true,
    }
    data = {
        twqh:[],
        scroll:'',
        isend:false,
    }
    async getTuweiqinghuaList(){
        let userSpecialInfo = wepy.getStorageSync(USER_SPECICAL_INFO) || {};
        let openid = userSpecialInfo.openid;
        if(typeof(openid) == "undefined"){
            wepy.navigateTo({
            url: '/pages/shouquan'
            })
            return false;
        }
        let json = await api.getTuweiqinghuaList({
            query: {
                openid:openid,
                scroll:this.scroll,
            }
        })
        if(json.data.data.length<10) this.isend=true;
        this.twqh=this.twqh.concat(json.data.data);
        this.scroll=json.data.scroll;
        this.$apply();
    }
    onReachBottom(){
        if(!this.isend)
            this.getTuweiqinghuaList();
    }
    onShareAppMessage() {
        return {
        title: '恋爱联盟',
        path: '/pages/home',
        };
    }
    methods= {
        tuweiqinghua(item){
            wx.navigateTo({
                url: "./tuweiqinghua?json="+JSON.stringify(item.datalist)
            })
        }
    }
    async onLoad() {
        this.getTuweiqinghuaList();
    }
    onShareAppMessage() {
        return {
        title: '土味情话',
        path: '/pages/twqh',
        };
    }
    onUnload(){
        var pages = getCurrentPages();
        if(pages.length==1){
            wx.switchTab({
                url: "/pages/home"
            })
        }
    }
}
</script>
<style lang="less">
.container{
    margin: 0rpx;
    padding-bottom: 20rpx;
    background: rgba(0, 0, 0, 0.1);
    .tou{
        margin: 0rpx;
        height: 1rpx;
        width: 100%;
    }
    .tuweiqinghua{
        border-radius:30rpx;
        margin-top: 30rpx;
        margin-left: 30rpx;
        margin-right: 30rpx;
        padding-left: 30rpx;
        padding-right: 30rpx;
        padding-top: 30rpx;
        padding-bottom: 30rpx;
        background: #ffffff;
        color: #000;
    }
    .textend{
        padding-top: 30rpx;
        padding-bottom: 30rpx;
        text-align:center;
    }
}
</style>

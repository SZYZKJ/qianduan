<template>
  <web-view class="webview" src="{{url}}">
  </web-view>
</template>

<script>
  import wepy from 'wepy';
  import api from "@/api/api";
  import {
    SYSTEM_INFO,
    USER_SPECICAL_INFO,
    USER_INFO
  } from '@/utils/constant';
  export default class viewhtml extends wepy.page {
    config = {
      navigationBarTitleText: '',
    }
    Page = {}
    data = {
      url: "",
    }
    async setJilu() {
      let userSpecialInfo = wepy.getStorageSync(USER_SPECICAL_INFO) || {};
      let unionid = userSpecialInfo.unionid;
      if (typeof(unionid) == "undefined") {
        wepy.navigateTo({
          url: '/pages/shouquan'
        })
        return false;
      }
      const json = await api.setJilu({
        unionid: unionid,
        jilutype: 'html',
        jilucontent: this.url,
      });
      this.$apply();
    }
    onShareAppMessage() {
      return {
        title: '恋爱联盟',
        path: '/pages/viewhtml?url=' + this.url,
      };
    }
    onLoad(options) {
      this.url = options.url;
      this.setJilu();
      this.$apply();
    }
    onUnload() {
      var pages = getCurrentPages();
      if (pages.length == 1) {
        wx.switchTab({
          url: "/pages/home"
        })
      }
    }
  }
</script>

<style lang="less">
  .webview {
    overflow: inherit;
    width: 750rpx;
  }
</style>
